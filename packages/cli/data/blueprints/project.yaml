# Project management blueprint
# Provides: Task, Milestone types

- author: system
  configs:
    # Fields
    - key: status
      type: Field
      name: Status
      dataType: option
      options: [pending, active, complete, cancelled, archived]
      default: pending

    - key: priority
      type: Field
      dataType: option
      options: [low, medium, high]
      default: medium

    - key: dueDate
      type: Field
      name: Due Date
      dataType: date

    - key: milestone
      type: Field
      name: Milestone
      dataType: relation
      range: [Milestone]

    - key: milestoneTasks
      type: Field
      name: Milestone Tasks
      dataType: relation
      range: [Task]
      allowMultiple: true

    # Types
    - key: Task
      type: Type
      name: Task
      fields:
        - title: { required: true }
        - description
        - status
        - priority
        - dueDate
        - parent: { only: [Task] }
        - children: { only: [Task] }
        - milestone

    - key: Milestone
      type: Type
      name: Milestone
      fields:
        - title: { required: true }
        - description
        - status
        - dueDate
        - milestoneTasks

# Navigation & Templates
- author: system
  configs:
    # --- Case 1: Frontmatter + body overlap ---
    # Template has {status} in body AND status in preamble (frontmatter).
    # If user edits body status but not frontmatter, the body edit should win.
    - key: task-detail-template
      type: Template
      name: Task Detail
      preamble: [status, priority]
      templateContent: |
        # {title}

        **Status:** {status}

        ## Description

        {description}

    # --- Case 2: Duplicate field slot in one template ---
    # Template has {title} in two places. If user edits them to different
    # values, extraction should detect a conflict.
    - key: task-summary-template
      type: Template
      name: Task Summary
      templateContent: |
        # {title}

        > **Summary:** {title}

        **Status:** {status}

    # Navigation: markdown tasks with preamble (Case 1)
    - key: nav-tasks-md
      type: Navigation
      path: tasks/{key}
      where: { type: Task }
      template: task-detail-template

    # Navigation: markdown tasks with duplicate slot (Case 2)
    - key: nav-tasks-summary
      type: Navigation
      path: summaries/{key}
      where: { type: Task }
      template: task-summary-template

    # --- Case 3: Same field across files ---
    # YAML route at a different path for the same entity. If both files
    # are modified with different values for the same field, sync should
    # detect a cross-file conflict.
    - key: nav-tasks-yaml
      type: Navigation
      path: tasks-yaml/{key}
      where: { type: Task }
      includes:
        key: true
        title: true
        status: true
        description: true

    # Milestones (YAML)
    - key: nav-milestone
      type: Navigation
      path: milestones/{key}
      where: { type: Milestone, status: [pending, active] }
      includes:
        key: true
        title: true
        description: true
        status: true
        dueDate: true
        milestoneTasks:
          title: true
          status: true

    # Backlog
    - key: nav-backlog
      type: Navigation
      path: backlog
      query:
        filters:
          type: Task
          milestone: { op: empty, value: true }
          status: [pending, active]

# Sample data
- author: system
  records:
    - type: Milestone
      key: mvp-release
      title: MVP Release
      description: Ship core functionality to beta testers
      status: active
      dueDate: 2025-02-15

    - type: Milestone
      key: v1-launch
      title: V1 Public Launch
      description: App store release
      dueDate: 2025-04-01

    - type: Task
      key: build-auth
      title: Build authentication flow
      description: Login, signup, password reset
      status: active
      priority: high
      milestone: mvp-release

    - type: Task
      key: design-onboarding
      title: Design onboarding screens
      status: pending
      priority: medium
      milestone: mvp-release

    - type: Task
      key: app-store-copy
      title: App store listing copy
      priority: low
      milestone: v1-launch

    - type: Task
      key: fix-landscape-bug
      title: Fix landscape orientation bug
      description: Orientation breaks on tablets
      status: active
      priority: medium
